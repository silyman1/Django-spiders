{%extends "sina/base.html"%}
{% load staticfiles %}
{%block content%}
<div class="moodlist">
  <h1 class="t_nav"><span>删删写写，回回忆忆，虽无法行云流水，却也可碎言碎语。</span><a href="/" class="n1">网站首页</a><a href="/" class="n2">碎言碎语</a></h1>
  <div class="bloglist">

  </div>

<footer>
  <div id="more" >
  加载更多
</div>
  <div id="no-more" >
  没有更多数据了...
</div>
  <br>
  <br>
  <p>Design by DanceSmile <a href="http://www.miitbeian.gov.cn/" target="_blank">蜀ICP备11002373号-1</a> <a href="/">网站统计</a></p>
</footer>
<script src="{%static 'js/silder.js'%}"></script>
<script type="text/javascript" >
  $(function(){

  /*初始化*/
  var counter = 0; /*计数器*/
  var pageStart = 0; /*offset*/
  var pageSize = 8; /*size*/

  /*首次加载*/
  getData(pageStart,pageSize);

  $("#no-more").hide();
  /*监听加载更多*/
  $("#more").click(function () {
    counter ++;
    pageStart = counter * pageSize;
    getData(pageStart, pageSize);
  });
  
  function getData(offset,size){
    $.ajax({
      type: 'GET',
      url: "{% url 'sina:single_ajax_blog' %}", 
      data:{offset:offset,size:size},
      success: function(reponse){
        var data_list = JSON.parse(reponse);
        var sum = reponse.length;

        var result = '';
        
        /************业务逻辑块：实现拼接html内容并append到页面*****************/
        
        //console.log(offset , size, sum);
        


        
        /*使用for循环*/
        for(var i=0; i< size; i++){
          result +='<ul class="arrow_box">'+ '<div class="sy">' +'<img src="' + data_list[i].avatar + '"> '+'<p name = "detail"><a href = "' + data_list[i].post_detail + '">' + data_list[i].post + '</a></p>'+ '</div>' +
              '<span class="date-view">&nbsp;' + data_list[i].post_time +'</span>'+
            '</ul>';
        }

        $('.bloglist').append(result);
        updatehtml();
        
        /*******************************************/
  
        /*隐藏more*/
        if (sum < size){
          $("#more").hide();
          $("#no-more").show();
        }else{
          $("#more").show();
          $("#no-more").hide();
        }
      },
      error: function(xhr, type){
        alert('Ajax error!');
      }
    });
  }
});
</script>
{%endblock%}